{% extends "prediction/base.html" %}
{% load static %}

{% block title %}Prediction Model - Earthquake Magnitude Prediction System{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-6">
    <h2 class="text-2xl font-bold text-primary">Earthquake Magnitude Prediction</h2>
    <p class="text-gray-600">Input seismic parameters to predict potential earthquake magnitude</p>
</div>

<!-- Prediction Form Card -->
<div class="w-full mx-auto p-6 bg-white rounded-2xl shadow-lg animate__animated animate__fadeIn mb-8">
    <form id="prediction-form" method="post" action="">
        {% csrf_token %}
        
        <div class="mb-6">
            <h3 class="text-xl font-semibold text-primary mb-4">Location Parameters</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="latitude" class="block text-sm font-medium text-gray-700 mb-1">Latitude</label>
                    <div class="relative rounded-md shadow-sm">
                        <input type="number" step="0.000001" name="latitude" id="latitude" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g. 37.7749" required>
                    </div>
                </div>
                <div>
                    <label for="longitude" class="block text-sm font-medium text-gray-700 mb-1">Longitude</label>
                    <div class="relative rounded-md shadow-sm">
                        <input type="number" step="0.000001" name="longitude" id="longitude" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g. -122.4194" required>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <label for="map-selector" class="block text-sm font-medium text-gray-700 mb-1">Or Select Location on Map</label>
                <div id="map-selector" class="h-64 bg-gray-100 rounded-md border border-gray-300">
                    <!-- Map selector will be initialized here via JavaScript -->
                    <div class="h-full w-full flex items-center justify-center">
                        <p class="text-gray-500">Map loading...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-6">
            <h3 class="text-xl font-semibold text-primary mb-4">Seismic Parameters</h3>
            
            <div class="mb-4">
                <label for="depth" class="block text-sm font-medium text-gray-700 mb-1">Depth (km): <span id="depth-value">10</span></label>
                <input type="range" name="depth" id="depth" min="0" max="700" value="10" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="tectonic_plate" class="block text-sm font-medium text-gray-700 mb-1">Tectonic Plate</label>
                    <select name="tectonic_plate" id="tectonic_plate" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select Plate</option>
                        <option value="pacific">Pacific</option>
                        <option value="north_american">North American</option>
                        <option value="eurasian">Eurasian</option>
                        <option value="indo_australian">Indo-Australian</option>
                        <option value="african">African</option>
                        <option value="antarctic">Antarctic</option>
                        <option value="south_american">South American</option>
                    </select>
                </div>
                <div>
                    <label for="fault_type" class="block text-sm font-medium text-gray-700 mb-1">Fault Type</label>
                    <select name="fault_type" id="fault_type" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select Fault Type</option>
                        <option value="normal">Normal</option>
                        <option value="reverse">Reverse</option>
                        <option value="strike_slip">Strike-slip</option>
                        <option value="oblique">Oblique</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="mb-6">
            <h3 class="text-xl font-semibold text-primary mb-4">Advanced Parameters (Optional)</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="p_wave" class="block text-sm font-medium text-gray-700 mb-1">P-Wave Velocity (km/s): <span id="p-wave-value">5.8</span></label>
                    <input type="range" name="p_wave" id="p_wave" min="4" max="8" value="5.8" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                <div>
                    <label for="s_wave" class="block text-sm font-medium text-gray-700 mb-1">S-Wave Velocity (km/s): <span id="s-wave-value">3.2</span></label>
                    <input type="range" name="s_wave" id="s_wave" min="2" max="5" value="3.2" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="historical_activity" class="block text-sm font-medium text-gray-700 mb-1">Historical Activity Level</label>
                    <select name="historical_activity" id="historical_activity" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select Level</option>
                        <option value="low">Low</option>
                        <option value="moderate">Moderate</option>
                        <option value="high">High</option>
                        <option value="very_high">Very High</option>
                    </select>
                </div>
                <div>
                    <label for="stress_accumulation" class="block text-sm font-medium text-gray-700 mb-1">Stress Accumulation</label>
                    <select name="stress_accumulation" id="stress_accumulation" class="w-full px-3 py-4 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select Level</option>
                        <option value="low">Low</option>
                        <option value="moderate">Moderate</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="flex justify-center">
            <button type="submit" class="bg-secondary hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg shadow-md animate__animated animate__pulse animate__infinite animate__slow transition-all duration-300 transform hover:scale-105">
                Generate Prediction
            </button>
        </div>
    </form>
</div>

<!-- Prediction Results (initially hidden) -->
<div id="prediction-results" class="max-w-xl mx-auto p-6 bg-white rounded-2xl shadow-lg hidden animate__animated">
    <div class="text-center mb-6">
        <h3 class="text-xl font-semibold text-primary mb-2">Prediction Results</h3>
        <div class="flex flex-col items-center justify-center">
            <div class="text-5xl font-bold text-primary mb-2">{{ prediction.magnitude }}</div>
            <div class="text-sm text-gray-500">Predicted Magnitude</div>
        </div>
    </div>
    
    <div class="flex justify-center mb-6">
        <span class="px-4 py-2 rounded-full {% if prediction.confidence < 70 %}bg-yellow-100 text-yellow-800{% else %}bg-green-100 text-green-800{% endif %}">
            Confidence: <span class="font-bold">{{ prediction.confidence }}%</span>
        </span>
    </div>
    
    <div class="mb-6">
        <h4 class="text-lg font-medium text-primary mb-3">Prediction Breakdown</h4>
        <div id="prediction-chart" class="h-48 bg-gray-100 rounded-md">
            <!-- Chart will be rendered here via JavaScript -->
            <div class="h-full w-full flex items-center justify-center">
                <p class="text-gray-500">Chart loading...</p>
            </div>
        </div>
    </div>
    
    <div class="mb-4">
        <h4 class="text-lg font-medium text-primary mb-2">Risk Assessment</h4>
        <div class="bg-gray-50 p-4 rounded-md">
            <div class="mb-2">
                <span class="font-medium">Potential Damage:</span>
                <span class="ml-2 {% if prediction.risk.damage == 'Low' %}text-green-600{% elif prediction.risk.damage == 'Moderate' %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ prediction.risk.damage }}
                </span>
            </div>
            <div class="mb-2">
                <span class="font-medium">Tsunami Risk:</span>
                <span class="ml-2 {% if prediction.risk.tsunami == 'Low' %}text-green-600{% elif prediction.risk.tsunami == 'Moderate' %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ prediction.risk.tsunami }}
                </span>
            </div>
            <div>
                <span class="font-medium">Secondary Effects:</span>
                <span class="ml-2 {% if prediction.risk.secondary == 'Low' %}text-green-600{% elif prediction.risk.secondary == 'Moderate' %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ prediction.risk.secondary }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="text-center">
        <a href="{% url 'prediction:prediction' %}" class="text-primary hover:text-blue-700 text-sm font-medium">
            Make a new prediction
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Update range slider values
        document.getElementById('depth').addEventListener('input', function() {
            document.getElementById('depth-value').textContent = this.value;
        });
        
        document.getElementById('p_wave').addEventListener('input', function() {
            document.getElementById('p-wave-value').textContent = this.value;
        });
        
        document.getElementById('s_wave').addEventListener('input', function() {
            document.getElementById('s-wave-value').textContent = this.value;
        });
        
        // Example form submission handling - in a real app this would be an AJAX call
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // In a real app, you'd send the form data to the server here
            // For demo, we'll just show the results panel
            const resultsPanel = document.getElementById('prediction-results');
            resultsPanel.classList.remove('hidden');
            resultsPanel.classList.add('animate__fadeIn');
            
            // Scroll to results
            resultsPanel.scrollIntoView({ behavior: 'smooth' });
        });
    });
</script>
{% endblock %}